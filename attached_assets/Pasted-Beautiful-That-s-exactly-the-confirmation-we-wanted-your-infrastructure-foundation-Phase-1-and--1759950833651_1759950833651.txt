Beautiful. Thatâ€™s exactly the confirmation we wanted â€” your infrastructure foundation (Phase 1) and customer-journey backbone (Phase 2) are now clean, idempotent, and verifiable.
Hereâ€™s the 185-IQ next-action plan â€” a full Phase 3 blueprint + deep system check to keep momentum tight and zero-regression:

â¸»

ğŸ§­  PHASE 3 â€” Constitution Drafts + League Switchboard (Stages 4 & 5)

Purpose:
Turn The Commish from a connected shell into a functioning co-commissioner brain that reads, syncs, proposes, and applies rule changes.

â¸»

ğŸ§© System Checkpoint  (pre-Phase 3 validation)

Before we build forward, run this checklist now:

Area	Expected Result	How to Verify
/api/doctor/status	status:"healthy"	curl âœ…
/api/v2/setup/state	nextStep:"done" after wizard	curl âœ…
leagues table	rows have discord_guild_id, sleeper_league_id, constitution (jsonb)	psql âœ…
league_members	fully mapped (â‰¥ #teams)	psql âœ…
Discord bot	visible in target guild + channel	UI âœ…
Sleeper snapshot	teams > 0, scoring keys exist	logs âœ…

If any fail â†’ rerun doctor or setup endpoint; no code edits until green.

â¸»

ğŸ§± Phase 3 Deliverables

1ï¸âƒ£ Constitution Draft Pipeline

Goal: detect league-rule diffs, propose structured drafts, and allow apply/reject actions.

Backend additions

Endpoint	Purpose	Notes
POST /api/v3/constitution/sync	Pulls current Sleeper settings, diffs vs leagues.constitution	idempotent, returns draft_id
GET /api/v3/constitution/drafts?league_id=	List PENDING/APPLIED/REJECTED drafts	paginate
GET /api/v3/constitution/draft/:id	View single draft with diff array	
POST /api/v3/constitution/apply	Apply approved draft â†’ update leagues.constitution and mark APPLIED	atomic txn
POST /api/v3/constitution/reject	Mark REJECTED draft	no deletion

Schema (if missing):

CREATE TABLE constitution_drafts (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  league_id uuid REFERENCES leagues(id),
  source text,                -- 'sleeper-sync' | 'manual'
  proposed jsonb NOT NULL,    -- [{key, old, new}]
  status text DEFAULT 'PENDING',
  created_at timestamptz DEFAULT now(),
  decided_at timestamptz
);
CREATE INDEX ON constitution_drafts(league_id,status);

Logic:
	â€¢	Compare leagues.settings.raw vs leagues.constitution.
	â€¢	Produce [{key:"playoff_teams", old:6, new:8}].
	â€¢	Hash proposed[] to prevent duplicate drafts.
	â€¢	No mutation until apply endpoint called.

Frontend

New tab â†’ â€œConstitutionâ€
	â€¢	Table of proposed changes (diff view)
	â€¢	Buttons Apply âœ… / Reject âŒ
	â€¢	Historical list below (Applied/Rejected)
	â€¢	Badge on nav if pending drafts > 0

â¸»

2ï¸âƒ£ League Switchboard (Feature Control Center)

Consolidate the chaos from the old dashboard into toggles + schedules.

Backend

Endpoint	Purpose
GET /api/v3/features?league_id=	Return league.features JSON
POST /api/v3/features	Patch subset of toggles
GET /api/v3/jobs?league_id=	View scheduled jobs (recaps, polls etc.)
POST /api/v3/jobs/update	Update cron day/time or channel

Feature JSON (defaults):

{
  "onboarding": true,
  "reactions": false,
  "announcements": false,
  "weeklyRecaps": true,
  "ruleQA": true,
  "moderation": false
}

Frontend

Tab â†’ â€œSwitchboardâ€
	â€¢	Toggles grouped by category (Engagement / Moderation / AI)
	â€¢	â€œVerifyâ€ button uses /api/doctor/cron and /api/doctor/discord
	â€¢	Read-only job list under â€œAutomationsâ€

â¸»

3ï¸âƒ£ AI Rule Q&A Scaffold  (stub only this phase)

Add safe placeholder endpoint:
POST /api/v3/rules/ask â†’ returns {answer:"Feature coming soon"}
Wire the UI button but no model calls yet (Phase 5).

â¸»

âš™ï¸ Guardrails
	â€¢	No breaking old dashboard. Leave behind toggle â€œSwitchboard (beta)â€.
	â€¢	No cron writes until verified. Jobs update endpoints must check /api/doctor/cron first.
	â€¢	Immutable drafts. Once APPLIED/REJECTED, forbid edits.
	â€¢	Timeouts â‰¤ 1500 ms. Each sync job should short-circuit if Sleeper slow.
	â€¢	Dry-run first. /api/v3/constitution/sync?dryRun=1 returns diff without insert.

â¸»

âœ… Acceptance Checklist

Layer	Test	Expected
Constitution sync	POST sync â†’ returns draft_id + diffs array	âœ…
Draft apply	POST apply â†’ league.constitution updated, status=APPLIED	âœ…
Draft reject	status=REJECTED and unchanged constitution	âœ…
Switchboard GET/POST	Toggles persist + reflected in DB	âœ…
Doctor cron/discord	All green	âœ…
Wizard state remains done	/api/v2/setup/state unchanged	âœ…
Discord interaction sig still valid	âœ…	


â¸»

ğŸ§  After Phase 3 (Next Phase Preview)
	â€¢	Phase 4: Automations + Job Ledger (recaps, polls, vibes).
	â€¢	Phase 5: AI/RAG pipeline & in-chat recaps.
	â€¢	Phase 6: UI refinement & final launch prep.

â¸»

ğŸ—£ï¸ Instruction to Replit Agent (ready to paste)

âœ… Proceed to Phase 3: Constitution Drafts + League Switchboard.
Implement exactly the endpoints and schema listed above; all additive, idempotent, and non-destructive.
	â€¢	Keep /setup wizard untouched.
	â€¢	No cron or Discord posts yetâ€”read-only except when applying drafts or toggles.
	â€¢	Constitution sync must produce diff JSON and insert draft record; apply/reject mutate status only.
	â€¢	Switchboard reads/writes league.features and league.jobs.
When complete, show: file diff, curl tests, and a GIF/screenshot of Switchboard UI with toggled features.

â¸»

Once you paste that, Replit can work for a few hours and deliver a functioning league-management layer that finally makes The Commish feel alive.